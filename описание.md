## ньюансы и подробности по сборке-настройке проекта.
Задачи проекта:
-	автоматизации рутинных, повторяющихся процессов мы используем gulp.js.

### В своем шаблоне мы используем следующие его возможности:
	-	компиляция scss в css, jade в html
	- 	автоматическое проставление вендорных префиксов
	-	оптимизация изображений
	-	конкатинация скриптов
	-	сжатие скриптов и стилей
	-	создание иконочных шрифтов и svg-спрайтов
	-	проверка html на валидность

### По шагам

	1.	установил - nvm(для установки и контроля версии ноды)
	2.	установил node 7.7.0 - через nvm
	3.	установил npm
	4.	установил npm в проект npm init
	5.	установил гальп npm install gulp -g
	6.	потом слинковал его в проект npm link gulp(!!не все пакеты линкуются!!)

### 			Плагины для разработки

`
-npm install rimraf gulp-pug gulp-sass gulp-inline-image gulp-autoprefixer gulp-plumber gulp-directory-sync browser-sync gulp-concat -g
`

`
-npm link rimraf gulp-jade gulp-sass gulp-inline-image gulp-autoprefixer gulp-plumber gulp-directory-sync browser-sync gulp-concat -g(не сработало,пришлось установить все плагины для гальпа отдельно глобально,отдельно в проект)
`

`
-npm install rimraf gulp-pug gulp-sass gulp-inline-image gulp-autoprefixer gulp-plumber gulp-directory-sync browser-sync gulp-concat (установка в проект)
`


### 			Плагины для сборки
`
-npm install gulp-html5-lint gulp-purifycss gulp-uglify gulp-imagemin imagemin-pngquant gulp-csso -g  (установка глобально)
`

`
-npm link gulp-html5-lint gulp-purifycss gulp-uglify gulp-imagemin imagemin-pngquant gulp-csso(не сработало,пришлось установить все плагины для гальпа отдельно глобально,отдельно в проект)
`
`
-npm install gulp-html5-lint gulp-purifycss gulp-uglify gulp-imagemin imagemin-pngquant gulp-csso (установка в проект)
`

#### Note: Эти плагины идут только глобально
`
 npm install node-gyp@3.6.0
 npm install mimer@0.2.1 -g
`
 * линкуем эти плагины из

1.	Cоздал файл gulpfile.js(для тасков-подключения плагинов с которыми работаем)
	В корне вашего проекта создайте gulpfile.js. Без этого файла gulp работать не будет. В нем описываются все таски, перечисленные в начале статьи. Сначала необходимо прописать зависимости для проекта.
	Обычно в репозитории плагинов есть информация о том, как прописывать зависимость.

### Пишем gulpfile.js

2.	Обычно в репозитории плагинов есть информация о том, как прописывать зависимость.
пример: 

`
// plugins for development
`
`
var gulp = require('gulp'),
	rimraf = require('rimraf'),
	jade = require('gulp-jade'),
	sass = require('gulp-sass'),
	inlineimage = require('gulp-inline-image'),
	prefix = require('gulp-autoprefixer'),
	plumber = require('gulp-plumber'),
	dirSync = require('gulp-directory-sync'),
	browserSync = require('browser-sync').create(),
	concat = require('gulp-concat');
`
`
// plugins for build
`
`
var purify = require('gulp-purifycss'),
	uglify = require('gulp-uglify'),
	imagemin = require('gulp-imagemin'),
	pngquant = require('imagemin-pngquant'),
	csso = require('gulp-csso');
`
`
//plugins for testing
`
`
var html5Lint = require('gulp-html5-lint');
`
3.	 Далее объявим переменные для папок проекта(откуда брать-куда плевать)Их будем использовать в тасках для компиляторов(jade,sass,stilus  и т.д)

	`
	var assetsDir = 'assets/'; //откуда берем
	var outputDir = 'dist/';   //куда ложим
	var buildDir = 'build/';
	`

	*	сами компиляторы
		*  **jade** 

	`
	gulp.task('jade', function () {// Название таска
		gulp.src([assetsDir + 'jade/*.jade', '!' + assetsDir + 'jade/_*.jade'])//берем файлы
			.pipe(plumber())
			.pipe(jade({pretty: true}))// компилим jade
			.pipe(gulp.dest(outputDir))// куда положить html
			.pipe(browserSync.stream());
	});
	`
	//Теперь, чтобы скомпилировать jade, достаточно ввести в консоль:gulp jade

		* **scss**

		`
		gulp.task('sass', function () {
			gulp.src([assetsDir + 'sass/**/*.scss', '!' + assetsDir + 'sass/**/_*.scss'])//берем файлы
				.pipe(plumber())
				.pipe(sass())// компилим sass
				.pipe(inlineimage())
				.pipe(prefix('last 3 versions'))
				.pipe(gulp.dest(outputDir + 'styles/'))// куда положить css
				.pipe(browserSync.stream());
		});
		`
	//аналогично sass:gulp sass

#### Note: Он соединит все таски из папки js/all в один скрипт.
		`
		-jsgulp.task('jsConcat', function () {
			return gulp.src(assetsDir + 'js/all/**/*.js')
				.pipe(concat('all.js', {newLine: ';'}))
				.pipe(gulp.dest(outputDir + 'js/'))
				.pipe(browserSync.stream());
		});
		`

	* Таски для синхронизации папок проекта между собой:

	`
	//-------------------------------------------------Synchronization
	gulp.task('imageSync', function () {
		return gulp.src('')
			.pipe(plumber())
			.pipe(dirSync(assetsDir + 'i/', outputDir + 'i/', {printSummary: true}))
			.pipe(browserSync.stream());
	});

	gulp.task('fontsSync', function () {
		return gulp.src('')
			.pipe(plumber())
			.pipe(dirSync(assetsDir + 'fonts/', outputDir + 'fonts/', {printSummary: true}))
			.pipe(browserSync.stream());
	});

	gulp.task('jsSync', function () {
		return gulp.src(assetsDir + 'js/*.js')
			.pipe(plumber())
			.pipe(gulp.dest(outputDir + 'js/'))
			.pipe(browserSync.stream());
	});
	//-------------------------------------------------Synchronization###
	`


	* Для того, чтобы отслеживать изменения в проекте и запускать таски автоматически используем gulp.watch

	`
	gulp.task('watch', function () {
		gulp.watch(assetsDir + 'jade/**/*.jade', ['jade']);
		gulp.watch(assetsDir + 'sass/**/*.scss', ['sass']);
		gulp.watch(assetsDir + 'js/**/*.js', ['jsSync']);
		gulp.watch(assetsDir + 'js/all/**/*.js', ['jsConcat']);
		gulp.watch(assetsDir + 'i/**/*', ['imageSync']);
		gulp.watch(assetsDir + 'fonts/**/*', ['fontsSync']);
	});
	`
	*	Для обновления браузера и локального хоста используем browser-sync
	
	`
	gulp.task('browser-sync', function () {
		browserSync.init({
			port: 1337,
			server: {
				baseDir: outputDir
			}
		});
	});
	`
	* 	Теперь, чтобы запустить все это хозяйство напишем дефолтный таск gulp

	`
	gulp.task('default', ['jade', 'sass', 'imageSync', 'fontsSync', 'jsConcat', 'jsSync', 'watch', 'browser-sync']);
	`
	Здесь мы указываем какие таски необходимо запустить вместе. Благодаря таску watch, gulp не закончит работу, а будет ждать изменений.

4.	Для того, чтобы запустить дефолтный таск введите

	`
	gulp
	`
5.	Откроется браузер и все будет компилироваться и обновляться автоматически.

	*	Теперь напишем сборку проекта:

	`
	//---------------------------------building final project folder
	//clean build folder
	gulp.task('cleanBuildDir', function (cb) {
		rimraf(buildDir, cb);
	});
	

	//minify images
	gulp.task('imgBuild', function () {
		return gulp.src(outputDir + 'i/**/*')
			.pipe(imagemin({
				progressive: true,
				svgoPlugins: [{removeViewBox: false}],
				use: [pngquant()]
			}))
			.pipe(gulp.dest(buildDir + 'i/'))
	});

	//copy fonts
	gulp.task('fontsBuild', function () {
		return gulp.src(outputDir + 'fonts/**/*')
			.pipe(gulp.dest(buildDir + 'fonts/'))
	});

	//copy html
	gulp.task('htmlBuild', function () {
		return gulp.src(outputDir + '**/*.html')
			.pipe(gulp.dest(buildDir))
	});

	//copy and minify js
	gulp.task('jsBuild', function () {
		return gulp.src(outputDir + 'js/**/*')
			.pipe(uglify())
			.pipe(gulp.dest(buildDir + 'js/'))
	});

	//copy, minify css
	gulp.task('cssBuild', function () {
		return gulp.src(outputDir + 'styles/**/*')
			.pipe(purify([outputDir + 'js/**/*', outputDir + '**/*.html']))
			.pipe(csso())
			.pipe(gulp.dest(buildDir + 'styles/'))
	});

	gulp.task('build', ['cleanBuildDir'], function () {
		gulp.start('imgBuild', 'fontsBuild', 'htmlBuild', 'jsBuild', 'cssBuild');
	});
	Запускаем

	gulp build
	И наконец таск для валидации:

	gulp.task('validation', function () {
		return gulp.src(buildDir + '**/*.html')
			.pipe(html5Lint());
	});
	`
6.	*	Потом создаем архитектуру  в директории assets/:
		
		`
		/assets/	
			/fonts
			/i
			/jade
			/js/all
			/sass
		`

	*	Общая архитектура проекта:
		
		`
		/dist/	( development mode )
		/fonts
		/i
		/js/all
		/sass
		(html файлы будут кидаться просто сюда)
		`
		`
		/build ( prodaction version)
		`

#### Итоговый gulpfile:
	`
	// plugins for development
	var gulp = require('gulp'),
		rimraf = require('rimraf'),
		jade = require('gulp-jade'),
		sass = require('gulp-sass'),
		inlineimage = require('gulp-inline-image'),
		prefix = require('gulp-autoprefixer'),
		plumber = require('gulp-plumber'),
		dirSync = require('gulp-directory-sync'),
		browserSync = require('browser-sync').create(),
		concat = require('gulp-concat');

	// plugins for build
	var purify = require('gulp-purifycss'),
		uglify = require('gulp-uglify'),
		imagemin = require('gulp-imagemin'),
		pngquant = require('imagemin-pngquant'),
		csso = require('gulp-csso');

	//plugins for testing
	var html5Lint = require('gulp-html5-lint');

	var assetsDir = 'assets/';
	var outputDir = 'dist/';
	var buildDir = 'build/';

	//----------------------------------------------------Compiling
	gulp.task('jade', function () {
		gulp.src([assetsDir + 'jade/*.jade', '!' + assetsDir + 'jade/_*.jade'])
			.pipe(plumber())
			.pipe(jade({pretty: true}))
			.pipe(gulp.dest(outputDir))
			.pipe(browserSync.stream());
	});

	gulp.task('sass', function () {
		gulp.src([assetsDir + 'sass/**/*.scss', '!' + assetsDir + 'sass/**/_*.scss'])
			.pipe(plumber())
			.pipe(sass())
			.pipe(inlineimage())
			.pipe(prefix('last 3 versions'))
			.pipe(gulp.dest(outputDir + 'styles/'))
			.pipe(browserSync.stream());
	});

	gulp.task('jsConcat', function () {
		return gulp.src(assetsDir + 'js/all/**/*.js')
			.pipe(concat('all.js', {newLine: ';'}))
			.pipe(gulp.dest(outputDir + 'js/'))
			.pipe(browserSync.stream());
	});

	//----------------------------------------------------Compiling###

	//-------------------------------------------------Synchronization
	gulp.task('imageSync', function () {
		return gulp.src('')
			.pipe(plumber())
			.pipe(dirSync(assetsDir + 'i/', outputDir + 'i/', {printSummary: true}))
			.pipe(browserSync.stream());
	});

	gulp.task('fontsSync', function () {
		return gulp.src('')
			.pipe(plumber())
			.pipe(dirSync(assetsDir + 'fonts/', outputDir + 'fonts/', {printSummary: true}))
			.pipe(browserSync.stream());
	});

	gulp.task('jsSync', function () {
		return gulp.src(assetsDir + 'js/*.js')
			.pipe(plumber())
			.pipe(gulp.dest(outputDir + 'js/'))
			.pipe(browserSync.stream());
	});
	//-------------------------------------------------Synchronization###


	//watching files and run tasks
	gulp.task('watch', function () {
		gulp.watch(assetsDir + 'jade/**/*.jade', ['jade']);
		gulp.watch(assetsDir + 'sass/**/*.scss', ['sass']);
		gulp.watch(assetsDir + 'js/**/*.js', ['jsSync']);
		gulp.watch(assetsDir + 'js/all/**/*.js', ['jsConcat']);
		gulp.watch(assetsDir + 'i/**/*', ['imageSync']);
		gulp.watch(assetsDir + 'fonts/**/*', ['fontsSync']);
	});

	//livereload and open project in browser
	gulp.task('browser-sync', function () {
		browserSync.init({
			port: 1337,
			server: {
				baseDir: outputDir
			}
		});
	});


	//---------------------------------building final project folder
	//clean build folder
	gulp.task('cleanBuildDir', function (cb) {
		rimraf(buildDir, cb);
	});


	//minify images
	gulp.task('imgBuild', function () {
		return gulp.src(outputDir + 'i/**/*')
			.pipe(imagemin({
				progressive: true,
				svgoPlugins: [{removeViewBox: false}],
				use: [pngquant()]
			}))
			.pipe(gulp.dest(buildDir + 'i/'))
	});

	//copy fonts
	gulp.task('fontsBuild', function () {
		return gulp.src(outputDir + 'fonts/**/*')
			.pipe(gulp.dest(buildDir + 'fonts/'))
	});

	//copy html
	gulp.task('htmlBuild', function () {
		return gulp.src(outputDir + '**/*.html')
			.pipe(gulp.dest(buildDir))
	});

	//copy and minify js
	gulp.task('jsBuild', function () {
		return gulp.src(outputDir + 'js/**/*')
			.pipe(uglify())
			.pipe(gulp.dest(buildDir + 'js/'))
	});

	//copy, minify css
	gulp.task('cssBuild', function () {
		return gulp.src(outputDir + 'styles/**/*')
			.pipe(purify([outputDir + 'js/**/*', outputDir + '**/*.html']))
			.pipe(csso())
			.pipe(gulp.dest(buildDir + 'styles/'))
	});

	//testing your build files
	gulp.task('validation', function () {
		return gulp.src(buildDir + '**/*.html')
			.pipe(html5Lint());
	});

	gulp.task('default', ['jade', 'sass', 'imageSync', 'fontsSync', 'jsConcat', 'jsSync', 'watch', 'browser-sync']);

	gulp.task('build', ['cleanBuildDir'], function () {
		gulp.start('imgBuild', 'fontsBuild', 'htmlBuild', 'jsBuild', 'cssBuild');
	});



### Команды
	* Чтобы скомпилировать jade, достаточно ввести в консоль: 
		`
		gulp jade
		`

	*	Аналогично sass: 
		`
		gulp sass
		`
	*	Для того, чтобы запустить дефолтный таск(запустит все плагины разом и будет авто компиляция-не нужно будет прописывать gulp jade,gulp sass)	 введите : 
	`
	gulp
	`



